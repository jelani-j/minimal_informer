version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - echo Installing cfn-lint...
      - pip install cfn-lint
      - echo Installing Node.js dependencies...
      - npm install

  build:
    commands:
      - echo Linting CloudFormation template...
      - cfn-lint template.yml
      - cp template.yml output.yml
      - echo Build phase complete
      - echo Zipping file for lambda function
      - zip -r lambda-function.zip node_modules

  post_build:
    commands:
      - echo Uploading zipped file to S3...
      - |
        BUCKET_NAME="minimal-informer-codepipeline-artifacts-${AWS_ACCOUNT_ID}-${AWS_REGION}"
        aws s3 cp lambda-function.zip s3://$BUCKET_NAME/path/to/destination/


artifacts:
  # Primary Artifact: BuildOutput
  name: BuildOutput
  files:
    - output.yml  
    - lambda-function.zip  # Lambda zip file containing function code
    - website_layout/**/*  # Static website layout files
    - images/**/*  # Static image files
    - index.html  # Main HTML file
  discard-paths: no  # Keep directory structure intact (for static site)